<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BitBytes ‚Äî Cybersecurity Courses</title>

<style>
:root{
  --bg:#f2f6fb;
  --card:#ffffff;
  --accent:#0d6efd;
  --accent-2:#38b6ff;
  --muted:#5b6d8a;
  --shadow: 0 6px 22px rgba(13,40,86,0.06);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Segoe UI,Arial,sans-serif;background:var(--bg);color:#17212b;-webkit-font-smoothing:antialiased}
header{
  background:linear-gradient(90deg,#163057,#1b2b55);
  color:#fff;padding:18px 16px;display:flex;align-items:center;gap:12px;
  box-shadow:0 6px 20px rgba(11,32,70,0.12);
  position:sticky;top:0;z-index:40;
}
.logo{display:flex;gap:10px;align-items:center}
.logo .mark{width:70px;height:70px;border-radius:50%;background:linear-gradient(180deg,var(--accent),#0066cc);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:26px;color:#051227;box-shadow:0 0 18px rgba(58,170,255,0.45);transition:0.3s;}
.title{font-weight:800;font-size:18px}
.header-right{margin-left:auto;display:flex;gap:8px;align-items:center}

nav{display:flex;gap:8px;padding:12px;background:transparent;align-items:center;flex-wrap:wrap}
.btn-neon{
  padding:10px 14px;border-radius:10px;border:1px solid rgba(13,110,253,0.15);
  background:linear-gradient(180deg,var(--accent),#0b57c8);
  color:#fff;cursor:pointer;font-weight:700;box-shadow:0 0 12px rgba(58,170,255,0.14), inset 0 0 8px rgba(26,155,255,0.06);
  transition:all .18s ease;
}
.btn-neon:hover{box-shadow:0 0 20px rgba(102,194,255,0.25), inset 0 0 12px rgba(56,182,255,0.12);transform:translateY(-3px)}
.btn-ghost{padding:10px 14px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:var(--card);cursor:pointer}

.container{max-width:1100px;margin:18px auto;padding:0 14px}
.main{display:block}

/* Pages */
.page{display:none;padding-bottom:40px}
.page.show{display:block;padding-top:12px}

.contentWrap{display:block}
.card{background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow);margin-bottom:14px}

.courseList{display:flex;flex-wrap:wrap;gap:12px}
.courseTile{
  width:220px;background:linear-gradient(180deg, #fff,#f7fbff);padding:14px;border-radius:12px;cursor:pointer;border:1px solid rgba(13,110,253,0.08);
  box-shadow:0 8px 30px rgba(13,110,253,0.05);
  transition:transform .12s, box-shadow .12s;
}
.courseTile:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(13,110,253,0.16)}
.courseTile strong{color:#0b3b70}
.courseTile .small{color:var(--muted)}

.moduleList{margin-top:14px}
.moduleItem{background:var(--card);border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.04);margin-bottom:10px}
.moduleHeader{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;cursor:pointer}
.moduleHeader h4{margin:0;font-size:15px}
.moduleHeader .meta{font-size:13px;color:var(--muted)}
.moduleBody{padding:14px;border-top:1px solid rgba(0,0,0,0.04);display:none;background:#fbfdff}
.moduleBody.show{display:block}

.progress{height:18px;background:#e6eefc;border-radius:10px;overflow:hidden}
.progressBar{height:18px;background:var(--accent);width:0%;text-align:center;color:#fff;font-size:13px;line-height:18px}

input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid #dbe7fb;background:#fff;margin-top:8px;font-size:14px}
textarea{min-height:100px}
.small{font-size:13px;color:var(--muted)}
.row{display:flex;gap:10px}
@media (max-width:900px){.row{flex-direction:column}}

.modalBack{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:80}
.modal{background:#fff;padding:18px;border-radius:12px;width:96%;max-width:480px}

.footer{margin-top:20px;text-align:center;color:var(--muted);font-size:13px;padding:16px}
@media (max-width:600px){
  header{flex-direction:column;align-items:flex-start;gap:6px}
  .header-right{width:100%;display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
  .courseList{justify-content:center}
  .courseTile{width:100%;max-width:320px}
  .row{flex-direction:column}
  h2{font-size:22px}
}

/* Admin Quiz Builder styles */
.admin-quiz-editor .question-block{border:1px dashed rgba(13,110,253,0.12);padding:12px;border-radius:10px;margin-bottom:10px;background:#fcfeff}
.admin-quiz-editor .question-block h4{margin:0 0 6px 0}
.admin-quiz-editor .inline-row{display:flex;gap:8px}
.admin-quiz-editor .inline-row > *{flex:1}
.small-muted{font-size:12px;color:var(--muted);margin-top:6px}
.quiz-timer{font-weight:700;color:#153a6b}
.quiz-question-card{margin-bottom:12px}
.disabled { opacity: 0.5; pointer-events: none; }
</style>
</head>
<body>
<header>
  <div class="logo"><div class="mark">SO</div><div><div class="title">BitBytes ‚Äî Cybersecurity Courses</div><div style="font-size:12px;color:#cfe6ff">Modules ‚Ä¢ Quiz ‚Ä¢ Certificate</div></div></div>
  <div class="header-right">
    <button class="btn-ghost" onclick="showHome()">Home</button>
    <button class="btn-ghost" onclick="showCourses()">Courses</button>
    <!-- Request Cert removed from header as requested -->
    <button class="btn-neon" onclick="openAdmin()">Admin</button>
  </div>
</header>

<div class="container">
  <main class="main contentWrap">

    <!-- HOME -->
    <section id="homePage" class="page show">
      <div class="card">
        <h2>Welcome to SOCanalyst</h2>
        <p class="small">Practical SOC training with structured modules and quizzes. Use the Courses page to open a track and complete module-wise lessons. Admin can add modules per course and build the final quiz.</p>
        <img src="https://i.imgur.com/9y3C7YX.jpeg" alt="cyber" style="width:100%;border-radius:10px;margin-top:12px">
        <p style="margin-top:10px;font-weight:700;color:#153a6b;">"The biggest threat to security is believing someone else is handling it."</p>
      </div>

      <div class="card">
        <h3>Feedback</h3>
        <input id="fbName" placeholder="Your name">
        <input id="fbEmail" placeholder="Your email">
        <textarea id="fbMsg" placeholder="Your feedback"></textarea>
        <div class="row" style="margin-top:10px">
          <button class="btn-neon" onclick="sendFeedback()">Send Feedback</button>
          <button class="btn-ghost" onclick="clearFeedback()">Clear</button>
        </div>
      </div>
    </section>

    <!-- COURSES -->
    <section id="coursesPage" class="page">
      <h2>Courses</h2>
      <div id="coursesContainer" class="courseList"></div>
    </section>

    <!-- COURSE DETAIL -->
    <section id="coursePage" class="page">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
        <div>
          <h2 id="courseTitle">Course</h2>
          <div id="courseSubtitle" class="small">Structured modules ‚Äî complete all to request a certificate</div>
        </div>
        <div style="min-width:220px">
          <div class="small">Progress</div>
          <div class="progress" style="margin-top:6px"><div id="courseProgress" class="progressBar">0%</div></div>
        </div>
      </div>

      <div id="modulesArea" class="moduleList" style="margin-top:16px"></div>

      <div style="margin-top:14px" class="row">
        <button class="btn-neon" onclick="startQuiz()">Start Final Quiz</button>
        <button class="btn-ghost" onclick="showCourses()">Back to Courses</button>
      </div>
    </section>

    <!-- NEW DEDICATED QUIZ PAGE (Option B: same file, looks like full page) -->
    <section id="newQuizPage" class="page">
      <h2>Final Quiz</h2>
      <div id="quizHeader" style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap">
        <div class="small">Course: <span id="quizCourseName" style="font-weight:700"></span></div>
        <div class="quiz-timer" id="quizTimerDisplay">‚è≥ Time Remaining: 00:00</div>
      </div>

      <div id="quizArea" style="margin-top:12px"></div>

      <div style="margin-top:12px" class="row">
        <button class="btn-neon" onclick="submitQuiz()">Submit Quiz</button>
        <button class="btn-ghost" onclick="cancelQuiz()">Cancel</button>
      </div>
      <div class="small-muted" style="margin-top:8px">Each correct answer is worth 2 marks. You must score at least 80% to request a certificate.</div>
    </section>

    <!-- CERTIFICATE REQUEST (opened only after quiz) -->
    <section id="certRequestPage" class="page">
      <h2>Certificate Request</h2>
      <div id="finalScoreDisplay" style="font-size:18px;font-weight:700;color:#0b3b70;margin-bottom:10px"></div>
      <div id="passFailMsg" style="font-size:15px;margin-bottom:14px;color:#153a6b"></div>
      <div class="card">
        <label>Full Name</label>
        <input id="reqName" placeholder="Full name">
        <label>Course Name</label>
        <input id="reqCourse" placeholder="Course" readonly>
        <label>Your Email</label>
        <input id="reqEmail" placeholder="you@example.com">

        <div style="margin-top:10px" class="row">
          <button id="reqCertBtn" class="btn-neon" onclick="requestCertificate()">Request Certificate</button>
          <button class="btn-ghost" onclick="showHome()">Done</button>
        </div>
        <div id="reqMsg" style="margin-top:8px;color:var(--muted)"></div>
      </div>
    </section>

    <!-- ADMIN PANEL (password protected) -->
    <section id="adminPanelSection" class="page">
      <h2>Admin Panel</h2>
      <div class="card">
        <label>Choose Course</label>
        <select id="adminCourseSelect" onchange="loadModulesForAdmin(); renderAdminQuizEditor()"></select>

        <div style="margin-top:12px">
          <strong>Modules (edit below)</strong>
          <div id="adminModulesList" style="margin-top:8px"></div>
          <div style="margin-top:8px" class="row">
            <button class="btn-neon" onclick="adminAddModule()">Add Module</button>
            <button class="btn-ghost" onclick="saveModules()">Save Modules</button>
          </div>
          <div style="margin-top:10px" class="small">Each module must have a title and HTML content. Save to persist in this browser.</div>
        </div>

        <hr style="margin:14px 0;border:none;border-top:1px solid #eef6ff">

        <div style="margin-top:12px">
          <strong>Quiz Builder (visual editor)</strong>
          <div id="adminQuizEditor" class="admin-quiz-editor" style="margin-top:8px"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn-neon" onclick="adminAddQuestion()">Add Question</button>
            <button class="btn-neon" onclick="saveQuizFromAdmin()">Save Quiz</button>
            <button class="btn-ghost" onclick="renderAdminQuizEditor()">Reload</button>
          </div>
          <div style="margin-top:8px" class="small">Add / edit questions and options here. Each question must have 4 options and a correct answer selected. Click Save Quiz to persist.</div>
        </div>
      </div>
    </section>

  </main>
</div>

<div class="footer">
    <div id="visitorCounter">Loading visitors...</div>
  ¬© SOCanalyst ‚Äî Modules & quizzes saved locally in your browser.
</div>


<!-- admin modal -->
<div id="adminModal" class="modalBack" style="display:none;align-items:center;justify-content:center">
  <div class="modal">
    <h3>Admin Login</h3>
    <p class="small">Enter admin password to access admin panel.</p>
    <input id="adminPassInput" placeholder="Password">
    <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
      <button class="btn-neon" onclick="verifyAdmin()">Enter</button>
      <button class="btn-ghost" onclick="closeAdminModal()">Cancel</button>
    </div>
    <div id="adminErr" style="color:#c23;margin-top:8px"></div>
  </div>
</div>

<script>
/* ---------- Data & Init ---------- */
const COURSES = [
  "L1 Security Analyst","L2 Security Analyst","SOC Manager",
  "Threat Hunter","SOC Engineer","Incident Responder"
];
const ADMIN_PASSWORD = 'bitbytes@745';
let currentCourse = null;
let quizTimer = null;
let totalTime = 0;

function hideAllPages(){ document.querySelectorAll('.page').forEach(p=>p.classList.remove('show')); }
function showHome(){ hideAllPages(); document.getElementById('homePage').classList.add('show'); }
function showCourses(){ hideAllPages(); document.getElementById('coursesPage').classList.add('show'); }
function showCoursePage(){ hideAllPages(); document.getElementById('coursePage').classList.add('show'); }
function showNewQuizPage(){ hideAllPages(); document.getElementById('newQuizPage').classList.add('show'); }
function showCertRequest(){ hideAllPages(); document.getElementById('certRequestPage').classList.add('show'); }
function showAdminPanel(){ hideAllPages(); document.getElementById('adminPanelSection').classList.add('show'); }

function init(){
  // populate courses
  const container = document.getElementById('coursesContainer'); container.innerHTML = '';
  COURSES.forEach(c=>{
    const tile = document.createElement('div'); tile.className='courseTile';
    tile.innerHTML = `<strong>${c}</strong><div class="small">Click to open</div>`;
    tile.onclick = ()=>openCourse(c);
    container.appendChild(tile);
  });
  // admin select
  const sel = document.getElementById('adminCourseSelect'); sel.innerHTML='';
  COURSES.forEach(c=>{ const op = document.createElement('option'); op.value=c; op.textContent=c; sel.appendChild(op); });
  // ensure showAnswersSetting exists for backward compatibility
  if(localStorage.getItem('showAnswersSetting')===null) localStorage.setItem('showAnswersSetting','no');
  showHome();
}
window.addEventListener('DOMContentLoaded', init);

/* ---------- Modules & Progress ---------- */
function loadModules(course){ try{ return JSON.parse(localStorage.getItem('modules_'+course) || '[]'); }catch(e){return[];} }
function saveModulesForCourse(course, modules){ localStorage.setItem('modules_'+course, JSON.stringify(modules)); }
function loadCompleted(course){ try{ return JSON.parse(localStorage.getItem('completed_'+course) || '[]'); }catch(e){ return []; } }
function saveCompleted(course, arr){ localStorage.setItem('completed_'+course, JSON.stringify(arr)); }

function openCourse(course){ currentCourse = course; document.getElementById('courseTitle').innerText = course; document.getElementById('courseSubtitle').innerText = 'Structured modules ‚Äî complete all to request a certificate'; const modules = loadModules(course); renderModules(modules); const completed = loadCompleted(course); updateCourseProgress(course, modules.length, completed.length); showCoursePage(); }

function renderModules(modules){ const area = document.getElementById('modulesArea'); area.innerHTML=''; if(modules.length===0){ area.innerHTML = '<div class="card small">No modules added yet. Use Admin to add modules.</div>'; return; } const completed = loadCompleted(currentCourse); modules.forEach((m, idx)=>{ const item = document.createElement('div'); item.className='moduleItem'; const header = document.createElement('div'); header.className='moduleHeader'; header.innerHTML = `<h4>${idx+1}. ${m.title}</h4><div class="meta">${completed.includes(idx)? 'Completed' : 'Incomplete'}</div>`; header.onclick = ()=>toggleModuleBody(idx); const body = document.createElement('div'); body.className='moduleBody'; body.id = 'moduleBody_'+idx; body.innerHTML = `<div>${m.content}</div><div style="margin-top:12px;display:flex;gap:8px"><button class="btn-neon" onclick="completeModule(${idx})">${completed.includes(idx)? 'Mark Incomplete':'Mark Complete'}</button><button class="btn-ghost" onclick="openModuleDetail(${idx})">Open Full</button></div>`; item.appendChild(header); item.appendChild(body); area.appendChild(item); }); }

function toggleModuleBody(i){ const el = document.getElementById('moduleBody_'+i); if(!el) return; el.classList.toggle('show'); }

function completeModule(idx){ if(currentCourse===null) return alert('Open a course first'); const completed = loadCompleted(currentCourse); const pos = completed.indexOf(idx); if(pos===-1) completed.push(idx); else completed.splice(pos,1); saveCompleted(currentCourse, completed); renderModules(loadModules(currentCourse)); const modules = loadModules(currentCourse); updateCourseProgress(currentCourse, modules.length, completed.length); }

function openModuleDetail(idx){ const modules = loadModules(currentCourse); if(!modules[idx]) return; const w = window.open('','_blank','width=800,height=600'); w.document.write(`<html><head><title>${modules[idx].title}</title><style>body{font-family:Segoe UI,Arial;padding:18px;background:#f7fbff;color:#17212b}h1{color:#153a6b}</style></head><body><h1>${modules[idx].title}</h1>${modules[idx].content}<p style="margin-top:18px"><button onclick="window.close()">Close</button></p></body></html>`); }

function updateCourseProgress(course,totalModules,completedCount){ const pct = totalModules===0?0:Math.round((completedCount/totalModules)*100); const bar = document.getElementById('courseProgress'); if(bar){ bar.style.width = pct + '%'; bar.innerText = pct + '%'; } }

/* ---------- QUIZ (new dedicated page, admin-built content) ---------- */

function startQuiz(){
  if(!currentCourse) return alert('Open a course first');
  const modules = loadModules(currentCourse);
  const completed = loadCompleted(currentCourse);
  if(completed.length < modules.length) return alert('Complete all modules before attempting quiz.');

  // load quiz saved by admin
  let q = [];
  try{ q = JSON.parse(localStorage.getItem('quiz_'+currentCourse) || '[]'); }catch(e){ q = []; }
  if(!q || q.length === 0) return alert('No quiz found for this course. Admin must create questions.');

  // deep copy
  q = JSON.parse(JSON.stringify(q));

  // shuffle questions and shuffle options inside each
  q = q.sort(()=>Math.random()-0.5).map(item=>{
    const opts = item.options.slice().sort(()=>Math.random()-0.5);
    // find mapped correct answer text (admin stored correctIndex)
    const correctText = item.options[item.correctIndex] || item.options[0];
    // ensure the object contains ans text for checking after shuffle
    return { q: item.q, options: opts, ans: correctText };
  });

  // store active quiz in session
  sessionStorage.setItem('activeQuiz', JSON.stringify(q));
  sessionStorage.setItem('activeQuizCourse', currentCourse);

  // render quiz page (all questions visible)
  document.getElementById('quizCourseName').innerText = currentCourse;
  const area = document.getElementById('quizArea'); area.innerHTML = '';
  q.forEach((it,i)=>{
    const card = document.createElement('div'); card.className='card quiz-question-card';
    let html = `<h3>${i+1}. ${escapeHtml(it.q)}</h3>`;
    it.options.forEach((opt, oi)=>{
      const optSafe = escapeHtml(opt);
      html += `<label style="display:block;margin-top:8px"><input type="radio" name="q${i}" value="${optSafe}"> ${optSafe}</label>`;
    });
    card.innerHTML = html;
    area.appendChild(card);
  });

  // timer: 1 minute per question
  totalTime = q.length * 60;
  startTimer();
  document.getElementById('quizTimerDisplay').innerText = `‚è≥ Time Remaining: ${formatTime(totalTime)}`;
  showNewQuizPage();
}

function startTimer(){ clearInterval(quizTimer); quizTimer = setInterval(()=>{ totalTime--; if(totalTime<=0){ clearInterval(quizTimer); submitQuiz(true); } document.getElementById('quizTimerDisplay').innerText = `‚è≥ Time Remaining: ${formatTime(totalTime)}`;},1000); }
function formatTime(sec){ const m = Math.floor(sec/60).toString().padStart(2,'0'); const s = (sec%60).toString().padStart(2,'0'); return `${m}:${s}`; }

function cancelQuiz(){
  if(confirm('Cancel quiz and return to course?')) {
    clearInterval(quizTimer);
    sessionStorage.removeItem('activeQuiz');
    sessionStorage.removeItem('activeQuizCourse');
    showCoursePage();
  }
}

function submitQuiz(auto=false){
  clearInterval(quizTimer);
  const course = sessionStorage.getItem('activeQuizCourse') || currentCourse;
  let q = [];
  try{ q = JSON.parse(sessionStorage.getItem('activeQuiz') || '[]'); }catch(e){ q = []; }
  if(q.length===0) return alert('No quiz in progress.');

  let score = 0;
  q.forEach((it,i)=>{
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    if(sel && sel.value === it.ans) score += 2;
  });
  const total = q.length * 2;
  const percentage = Math.round((score/total)*100);
  localStorage.setItem('lastscore_'+course, String(percentage));

  // prepare certificate page
  document.getElementById('reqCourse').value = course;
  document.getElementById('finalScoreDisplay').innerText = `Final Score: ${score} / ${total} (${percentage}%)`;

  const reqBtn = document.getElementById('reqCertBtn');
  if(percentage >= 80){
    document.getElementById('passFailMsg').innerText = 'üéâ Congratulations! You passed the exam.';
    document.getElementById('passFailMsg').style.color = '#0a802e';
    reqBtn.classList.remove('disabled');
    reqBtn.disabled = false;
  } else {
    document.getElementById('passFailMsg').innerText = '‚ùó You scored below 80%. Please learn the modules again and retake the quiz.';
    document.getElementById('passFailMsg').style.color = '#b30000';
    reqBtn.classList.add('disabled');
    reqBtn.disabled = true;
  }

  // show certificate request page automatically
  sessionStorage.removeItem('activeQuiz');
  sessionStorage.removeItem('activeQuizCourse');
  showCertRequest();
}

/* ---------- Certificate request ---------- */
function requestCertificate(){
  const name = document.getElementById('reqName').value.trim(); const course = document.getElementById('reqCourse').value.trim(); const email = document.getElementById('reqEmail').value.trim();
  if(!name||!course||!email) return alert('Fill name, course and email');
  const lastScore = Number(localStorage.getItem('lastscore_'+course) || -1);
  if(lastScore < 80) return alert('You must score at least 80% to request certificate.');

  const to='bitbytes.soc@gmail.com';
  const subject = encodeURIComponent('Certificate Request ‚Äî '+course+' ‚Äî '+name);
  const body = encodeURIComponent(`Requesting certificate\n\nName: ${name}\nCourse: ${course}\nEmail: ${email}\nScore: ${lastScore}%\nDate: ${new Date().toLocaleString()}\n\nPlease issue certificate.`);
  const link = `mailto:${to}?subject=${subject}&body=${body}`;
  window.location.href = link;

  const reqs = JSON.parse(localStorage.getItem('cert_requests') || '[]');
  reqs.unshift({name,course,email,score:lastScore,date:new Date().toISOString()});
  localStorage.setItem('cert_requests', JSON.stringify(reqs));
  document.getElementById('reqMsg').innerText = 'Request prepared in mail client and saved locally.';
}

/* ---------- Feedback ---------- */
function sendFeedback(){ const name = document.getElementById('fbName').value.trim() || 'Anonymous'; const email = document.getElementById('fbEmail').value.trim() || ''; const msg = document.getElementById('fbMsg').value.trim(); if(!msg) return alert('Please write feedback first.'); const to='bitbytes.soc@gmail.com'; const subject = encodeURIComponent('Feedback from '+name); const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\n\n${msg}`); const link = `mailto:${to}?subject=${subject}&body=${body}`; window.location.href = link; const f = JSON.parse(localStorage.getItem('feedbacks') || '[]'); f.unshift({name,email,msg,date:new Date().toISOString()}); localStorage.setItem('feedbacks', JSON.stringify(f)); alert('Feedback prepared in your email client.'); document.getElementById('fbName').value=''; document.getElementById('fbEmail').value=''; document.getElementById('fbMsg').value=''; }
function clearFeedback(){ document.getElementById('fbName').value=''; document.getElementById('fbEmail').value=''; document.getElementById('fbMsg').value=''; }

/* ---------- Admin flow & Quiz Builder (visual) ---------- */

function openAdmin(){ if(sessionStorage.getItem('admin_auth')==='true'){ populateAdminModules(); showAdminPanel(); return; } document.getElementById('adminModal').style.display='flex'; }
function closeAdminModal(){ document.getElementById('adminModal').style.display='none'; document.getElementById('adminErr').innerText=''; document.getElementById('adminPassInput').value=''; }
function verifyAdmin(){ const v=document.getElementById('adminPassInput').value; if(v===ADMIN_PASSWORD){ sessionStorage.setItem('admin_auth','true'); closeAdminModal(); populateAdminModules(); showAdminPanel(); } else { document.getElementById('adminErr').innerText='Incorrect password'; } }

function populateAdminModules(){ const sel = document.getElementById('adminCourseSelect'); sel.innerHTML=''; COURSES.forEach(c=>{ const op=document.createElement('option'); op.value=c; op.textContent=c; sel.appendChild(op); }); loadModulesForAdmin(); renderAdminQuizEditor(); }

function loadModulesForAdmin(){ const course = document.getElementById('adminCourseSelect').value; const modules = loadModules(course); const list = document.getElementById('adminModulesList'); list.innerHTML=''; modules.forEach((m, idx)=>{ const wrapper = document.createElement('div'); wrapper.style.marginBottom='10px'; wrapper.innerHTML = `<input value="${m.title.replace(/"/g,'&quot;')}" placeholder="Module title" id="mod_title_${idx}" style="margin-top:6px"><textarea id="mod_content_${idx}" style="margin-top:6px">${m.content}</textarea><div style="display:flex;gap:8px;margin-top:6px"><button class="btn-neon" onclick="saveModuleEdits('${course}',${idx})">Save</button><button class="btn-ghost" onclick="deleteModule('${course}',${idx})">Delete</button></div>`; list.appendChild(wrapper); }); if(modules.length===0) list.innerHTML = '<div class="small">No modules yet ‚Äî add one below.</div>'; }

function adminAddModule(){ const course=document.getElementById('adminCourseSelect').value; const modules = loadModules(course); modules.push({title:'New Module', content:'<p>Module content here</p>'}); saveModulesForCourse(course, modules); loadModulesForAdmin(); alert('Module added ‚Äî edit title/content and Save.'); }

function saveModuleEdits(course, idx){ const title = document.getElementById('mod_title_'+idx).value; const content = document.getElementById('mod_content_'+idx).value; const modules = loadModules(course); if(!modules[idx]) return alert('Module missing'); modules[idx].title = title; modules[idx].content = content; saveModulesForCourse(course, modules); alert('Module saved.'); }

function deleteModule(course, idx){ if(!confirm('Delete this module?')) return; const modules = loadModules(course); modules.splice(idx,1); saveModulesForCourse(course, modules); loadModulesForAdmin(); alert('Deleted.'); }

function saveModules(){ const course = document.getElementById('adminCourseSelect').value; const list = document.getElementById('adminModulesList'); const inputs = list.querySelectorAll('input[id^="mod_title_"]'); const modules = []; inputs.forEach(inp=>{ const id = inp.id; const idx = id.split('_').pop(); const title = inp.value; const contentEl = document.getElementById('mod_content_'+idx); const content = contentEl? contentEl.value : ''; modules.push({title, content}); }); saveModulesForCourse(course, modules); alert('All modules saved for ' + course); }

/* ---------- Admin Quiz Builder functions (visual, no JSON) ---------- */

function getQuizForCourse(course){
  try{ return JSON.parse(localStorage.getItem('quiz_'+course) || '[]'); }catch(e){ return []; }
}

function adminAddQuestion(){
  const course = document.getElementById('adminCourseSelect').value;
  const quiz = getQuizForCourse(course);
  // default blank question
  quiz.push({
    q: 'New question',
    options: ['Option A','Option B','Option C','Option D'],
    correctIndex: 0
  });
  localStorage.setItem('quiz_'+course, JSON.stringify(quiz));
  renderAdminQuizEditor();
}

function renderAdminQuizEditor(){
  const course = document.getElementById('adminCourseSelect').value;
  const editor = document.getElementById('adminQuizEditor');
  editor.innerHTML = '';
  const quiz = getQuizForCourse(course);

  if(!quiz || quiz.length===0){
    editor.innerHTML = '<div class="small">No questions yet. Click "Add Question" to create the first one.</div>';
    return;
  }

  quiz.forEach((item, idx)=>{
    const block = document.createElement('div');
    block.className = 'question-block';
    block.dataset.idx = idx;

    const header = document.createElement('h4');
    header.innerText = `Q${idx+1}:`;
    block.appendChild(header);

    const qta = document.createElement('textarea');
    qta.value = item.q;
    qta.placeholder = 'Question text';
    qta.style.marginTop = '6px';
    block.appendChild(qta);

    // options
    for(let i=0;i<4;i++){
      const lab = document.createElement('div');
      lab.className = 'inline-row';
      lab.style.marginTop = '8px';
      const inp = document.createElement('input');
      inp.value = item.options[i] || '';
      inp.placeholder = `Option ${String.fromCharCode(65+i)}`;
      inp.id = `q${idx}_opt_${i}`;
      lab.appendChild(inp);
      block.appendChild(lab);
    }

    const controls = document.createElement('div');
    controls.style.marginTop = '8px';
    controls.innerHTML = `
      <div style="display:flex;gap:8px;align-items:center">
        <label style="min-width:120px">Correct Answer:</label>
        <select id="q${idx}_correct">
          <option value="0">A</option>
          <option value="1">B</option>
          <option value="2">C</option>
          <option value="3">D</option>
        </select>
        <div style="flex:1"></div>
        <button class="btn-ghost" id="delete_q_${idx}">Delete Question</button>
      </div>
    `;
    block.appendChild(controls);
    editor.appendChild(block);

    // set correct index
    const sel = block.querySelector(`#q${idx}_correct`);
    sel.value = String(item.correctIndex || 0);

    // delete button
    block.querySelector(`#delete_q_${idx}`).onclick = ()=>{
      if(!confirm('Delete this question?')) return;
      const qarr = getQuizForCourse(course);
      qarr.splice(idx,1);
      localStorage.setItem('quiz_'+course, JSON.stringify(qarr));
      renderAdminQuizEditor();
    };
  });
}

function saveQuizFromAdmin(){
  const course = document.getElementById('adminCourseSelect').value;
  const editor = document.getElementById('adminQuizEditor');
  const blocks = editor.querySelectorAll('.question-block');
  const arr = [];
  for(let b=0;b<blocks.length;b++){
    const block = blocks[b];
    const qtext = block.querySelector('textarea').value.trim();
    const opts = [];
    for(let i=0;i<4;i++){
      const v = block.querySelector(`#q${b}_opt_${i}`).value.trim();
      opts.push(v || `Option ${String.fromCharCode(65+i)}`);
    }
    const correct = Number(block.querySelector(`#q${b}_correct`).value || 0);
    // validation
    if(!qtext) return alert('Please fill all question texts before saving.');
    arr.push({ q: qtext, options: opts, correctIndex: correct });
  }
  localStorage.setItem('quiz_'+course, JSON.stringify(arr));
  alert('Quiz saved for ' + course);
  renderAdminQuizEditor();
}

/* ---------- Utility ---------- */

function escapeHtml(unsafe) {
    if(unsafe === null || unsafe === undefined) return '';
    return unsafe
         .replace(/&/g, "&amp;")
         .replace(/</g, "&lt;")
         .replace(/>/g, "&gt;")
         .replace(/"/g, "&quot;")
         .replace(/'/g, "&#039;");
}

/* expose some functions for inline use */
window.openCourse = openCourse; window.completeModule = completeModule; window.openModuleDetail = openModuleDetail; window.startQuiz = startQuiz; window.submitQuiz = submitQuiz; window.requestCertificate = requestCertificate; window.sendFeedback = sendFeedback; window.saveModules = saveModules; window.adminAddModule = adminAddModule; window.loadModulesForAdmin = loadModulesForAdmin; window.saveQuizFromAdmin = saveQuizFromAdmin; window.renderAdminQuizEditor = renderAdminQuizEditor; window.adminAddQuestion = adminAddQuestion; window.openAdmin = openAdmin; window.showHome = showHome; window.showCourses = showCourses; window.showCertRequest = showCertRequest;
</script>
<script>
function updateVisitorCounter() {
  fetch('https://api.countapi.xyz/hit/socanalyst.bitbytes/visits')
    .then(res => res.json())
    .then(data => {
      document.getElementById('visitorCounter').innerText =
        "Visitors: " + data.value;
    })
    .catch(() => {
      document.getElementById('visitorCounter').innerText =
        "Visitors: (offline)";
    });
}
updateVisitorCounter();
</script>
</body>
</html>
